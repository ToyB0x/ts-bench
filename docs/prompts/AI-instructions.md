# TypeScript最適化AI自動実行プロンプト

## 目的

**このプロンプトを読んだAIエージェントは、ユーザのTypeScriptプロジェクトを自動分析し、最適化計画を立案・実行してください。**

ts-benchプロジェクトの`docs/prompts/_meta.md`で定義された32の最適化手法を基に、あなた（AIエージェント）が以下を自律的に実行します：

1. ユーザのプロジェクト状況を分析
2. 最適な実行順序を決定  
3. 段階的に最適化を実行
4. 効果を測定・記録
5. 進捗を管理・報告

## AIエージェント実行指示

**あなたは以下のフローに従って、ユーザのTypeScriptプロジェクトを自動的に最適化してください。**

### ステップ1: 自動プロジェクト分析

まず、ユーザのプロジェクトを以下の順序で分析し、現状を把握してください：

1. **コードベース規模の調査**
   ```bash
   # TypeScriptファイル数とサイズを確認
   find . -name "*.ts" -o -name "*.tsx" | wc -l
   find . -name "*.ts" -o -name "*.tsx" | xargs wc -l | tail -1
   ```

2. **現在の設定確認**
   - `tsconfig.json`の内容確認
   - `package.json`の依存関係とスクリプト確認
   - モノレポ構成（Turborepo/Nx等）の有無確認

3. **ベースライン性能測定**
   ```bash
   # コンパイル時間の測定
   time npx tsc --noEmit
   # 詳細診断の実行
   npx tsc --noEmit --extendedDiagnostics
   ```

### ステップ2: 自動最適化計画立案

分析結果を基に、`docs/prompts/_meta.md`の32の手法から最適な実行計画を自動生成してください：

**優先順位決定ロジック**:
1. **実装容易度⭐⭐⭐⭐⭐** かつ **デグレリスク⭐** の手法を最優先
2. **性能影響⭐⭐⭐⭐以上** の手法を次優先
3. プロジェクト規模に応じた調整：
   - 小規模（<100ファイル）: 設定最適化中心
   - 中規模（100-1000ファイル）: コード構造最適化追加
   - 大規模（1000ファイル以上）: プロジェクト構造最適化必須

**計画出力形式**:
```
## 最適化実行計画

### プロジェクト概要
- TypeScriptファイル数: XXX
- 総行数: XXX
- 現在のコンパイル時間: XXX秒
- モノレポ構成: あり/なし

### 実行フェーズ
#### フェーズ1: 基本設定最適化（推定効果: XX%改善）
1. [手法名] - [理由] - [推定工数: XX分]
2. ...

#### フェーズ2: コード構造最適化（推定効果: XX%改善）
1. [手法名] - [理由] - [推定工数: XX時間]
2. ...

#### フェーズ3: 高度な最適化（推定効果: XX%改善）
1. [手法名] - [理由] - [推定工数: XX日]
2. ...
```

### ステップ3: 自動最適化実行

計画に従って、段階的に最適化を実行してください：

#### 実行前の自動準備
```bash
# ブランチ作成
git checkout -b typescript-optimization
# ベースライン記録
echo "実行前コンパイル時間: $(time npx tsc --noEmit 2>&1 | grep real)" > optimization-log.txt
```

#### 各最適化手法の自動実行

**あなたが実行すべき設定最適化の例**:
```typescript
// 1. tsconfig.json調整
{
  "compilerOptions": {
    "target": "ES2022",           // モダンターゲットで高速化
    "module": "ESNext",           // 最新モジュール形式
    "moduleResolution": "bundler", // 最適な解決方式
    "skipLibCheck": true,         // ライブラリチェックスキップ
    "incremental": true,          // 増分コンパイル有効化
    "isolatedModules": true       // 並列処理有効化
  },
  "exclude": ["dist", "node_modules", "**/*.test.ts"] // 不要ファイル除外
}
```

**各手法実行後の測定**:
```bash
# 効果測定
echo "手法: [手法名]" >> optimization-log.txt
echo "実行後コンパイル時間: $(time npx tsc --noEmit 2>&1 | grep real)" >> optimization-log.txt
echo "改善率: [計算結果]%" >> optimization-log.txt
echo "---" >> optimization-log.txt
```

#### 自動進捗管理

各手法実行後、あなたは必ず以下のテーブルを更新し、ユーザに進捗報告してください：

| 手法 | 実行状況 | 最終実施日 | 実装容易度 | 性能影響 | デグレリスク | 実行結果 | 測定値（改善前→後） | 残課題・次回アクション |
|------|----------|------------|------------|----------|-------------|----------|---------------------|---------------------|
| [手法名] | 🟡/🟢 | YYYY-MM-DD | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐ | [結果詳細] | XXX秒→YYY秒 | [次のステップ] |

### ステップ4: 自動検証とレポート

#### 総合効果の自動検証
```bash
# 最終測定
npm run build  # 実際のビルドでも検証
npm run test   # テストで機能性確認
npm run lint   # コード品質確認
```

#### 問題発生時の自動対処
```bash
# ロールバック手順
git checkout tsconfig.json  # 設定のみロールバック
# または
git reset --hard HEAD~1     # 完全ロールバック
```

## AIエージェント必須実行ルール

### あなたが守るべき重要なルール
1. **測定駆動**: 全ての変更で事前事後の性能測定を実施
2. **段階的実行**: 一度に複数手法を適用せず、1つずつ検証
3. **安全性優先**: デグレリスク⭐⭐以下から開始
4. **文書化**: 進捗管理テーブルを毎回更新

### 手法別実行指示（重要）

#### isolatedDeclarations採用時
```bash
# TypeScript 5.5+確認
npx tsc --version
# 明示的型注釈の大量追加が必要
# 例：関数戻り値型の明示
export const calculateTotal = (items: Item[]): number => { ... }
```

#### 型展開防止実装時
```typescript
// 悪い例：指数的型計算
type DeepNested<T> = T extends object ? { [K in keyof T]: DeepNested<T[K]> } : T;

// 良い例：型推論制限
type DeepNested<T> = T extends object ? { [K in keyof T]: T[K] } : T;
```

#### 生成コード事前コンパイル
```bash
# Zodスキーマ等の事前変換
npx tsc src/generated/schemas.ts --outDir dist/generated --declaration
```

### 自動エラー対処パターン

**型エラー大量発生時**:
```bash
# isolatedModules有効化で発生する典型的エラー
# 'export type' を使用して型のみエクスポート
export type { User } from './types';
export { createUser } from './functions';
```

**ビルド失敗時**:
```bash
# 段階的ロールバック
git stash  # 一時退避
# 問題箇所特定後
git stash pop  # 復元して修正
```

## 進捗管理テーブル（AIエージェントが実行時に更新）

**重要: あなたは以下のテーブルを実行過程で必ず更新し、ユーザに進捗を報告してください**

### 進捗管理の目的
- 改善施策の実行進捗を継続的に追跡
- 実行結果と効果測定の記録  
- 残された課題と次のアクションの明確化
- 定期的なメンテナンス活動での活用

### 凡例
**実行状況**: 🔴未着手 🟡進行中 🟢完了 ⚪保留
**性能影響**: ⭐⭐⭐⭐⭐（50%以上）⭐⭐⭐⭐（20-50%）⭐⭐⭐（10-20%）⭐⭐（5-10%）⭐（5%未満）  
**実装容易度**: ⭐⭐⭐⭐⭐（簡単）～⭐（困難）
**デグレリスク**: ⭐（低）～⭐⭐⭐⭐⭐（高）

### 1. 設定最適化

| 手法 | 実行状況 | 最終実施日 | 実装容易度 | 性能影響 | デグレリスク | 実行結果 | 測定値（改善前→後） | 残課題・次回アクション |
|------|----------|------------|------------|----------|-------------|----------|---------------------|---------------------|
| tsconfig.json調整 | 🔴 | 未実施 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | コンパイル時間: 未測定→未測定 | プロジェクト分析後に実行 |
| isolatedDeclarations | 🔴 | 未実施 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ | 未実行 | 並列処理効果: 未測定→未測定 | TypeScript 5.5+要件確認 |
| isolatedModules | 🔴 | 未実施 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐ | 未実行 | 並列型チェック: 未測定→未測定 | tsconfig.json調整後に実行 |
| 型定義絞り込み | 🔴 | 未実施 | ⭐⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | @types削減数: 0個 | package.json分析が必要 |
| コンパイラオプション最適化 | 🔴 | 未実施 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | strict/incremental: 未設定 | tsconfig.json調整と同時実行 |
| excludeパターン最適化 | 🔴 | 未実施 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐ | 未実行 | 除外ファイル数: 未算出 | プロジェクト構造調査後実行 |
| baseUrl/paths最適化 | 🔴 | 未実施 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | 型解決時間: 未測定→未測定 | import分析後に実行 |
| extendedDiagnostics活用 | 🔴 | 未実施 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐ | 未実行 | ボトルネック: 未特定 | 最初に実行してベースライン取得 |

### 2. コード構造最適化

| 手法 | 実行状況 | 最終実施日 | 実装容易度 | 性能影響 | デグレリスク | 実行結果 | 測定値（改善前→後） | 残課題・次回アクション |
|------|----------|------------|------------|----------|-------------|----------|---------------------|---------------------|
| 明示的型注釈 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐⭐⭐ | ⭐ | 未実行 | 型推論削減: 未測定 | isolatedDeclarations採用時に実行 |
| 型展開防止 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ | 未実行 | コンパイル時間: 未測定 | generateTrace分析後に実行 |
| const assertions最適化 | 🔴 | 未実施 | ⭐⭐⭐ | ⭐⭐ | ⭐ | 未実行 | as const適用数: 0箇所 | コード分析後に実行 |
| Interface vs Union最適化 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐ | ⭐⭐ | 未実行 | union→interface変換数: 0件 | 型定義調査後に実行 |
| 型エイリアス最適化 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐ | ⭐ | 未実行 | エイリアス化数: 0件 | 複雑な型定義特定後実行 |
| 生成コード事前コンパイル | 🔴 | 未実施 | ⭐⭐ | ⭐⭐⭐⭐ | ⭐ | 未実行 | コンパイル時間: 未測定 | 生成ファイル調査後実行 |
| Conditional Types削減 | 🔴 | 未実施 | ⭐ | ⭐⭐⭐ | ⭐⭐ | 未実行 | 条件付き型削減数: 0件 | 高度な型ロジック分析後実行 |

### 3. プロジェクト構造最適化

| 手法 | 実行状況 | 最終実施日 | 実装容易度 | 性能影響 | デグレリスク | 実行結果 | 測定値（改善前→後） | 残課題・次回アクション |
|------|----------|------------|------------|----------|-------------|----------|---------------------|---------------------|
| Project References | ⚪ | 保留中 | ⭐ | ⭐⭐ | ⭐⭐⭐ | 実装見送り | Turborepo非推奨のため | 他手法を優先実行 |
| モノレポ最適化 | 🔴 | 未実施 | ⭐ | ⭐⭐⭐ | ⭐⭐⭐ | 未実行 | 並列化効果: 未測定 | モノレポ構成確認後実行 |
| package.json exports最適化 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | API制御範囲: 未設定 | パッケージ構造分析後実行 |
| 内部パッケージdts生成 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | 生成型定義数: 0件 | モノレポ最適化後実行 |
| Barrel exports最適化 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐ | ⭐⭐ | 未実行 | 最適化ファイル数: 0件 | index.ts分析後実行 |
| 依存グラフ最適化 | 🔴 | 未実施 | ⭐ | ⭐⭐⭐ | ⭐⭐⭐ | 未実行 | 分離依存数: 0件 | 依存分析ツール活用後実行 |
| ファイル分割戦略 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐ | ⭐⭐ | 未実行 | 分割ファイル数: 0件 | 大型ファイル特定後実行 |
| 依存関係最適化 | 🔴 | 未実施 | ⭐ | ⭐⭐ | ⭐⭐ | 未実行 | 削除import数: 0件 | import分析ツール活用後実行 |

### 4. ビルド・ツール最適化

| 手法 | 実行状況 | 最終実施日 | 実装容易度 | 性能影響 | デグレリスク | 実行結果 | 測定値（改善前→後） | 残課題・次回アクション |
|------|----------|------------|------------|----------|-------------|----------|---------------------|---------------------|
| インクリメンタルビルド | 🔴 | 未実施 | ⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | 初回→増分ビルド時間: 未測定→未測定 | tsconfig.json最適化後実行 |
| SWC/esbuild統合 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐ | 未実行 | 変換処理速度: 未測定 | ビルド環境分析後実行 |
| 並列型チェック | 🔴 | 未実施 | ⭐⭐ | ⭐⭐ | ⭐ | 未実行 | 並列処理効果: 未測定 | webpack等環境確認後実行 |
| Watch mode最適化 | 🔴 | 未実施 | ⭐⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | 開発時応答時間: 未測定 | 開発環境確認後実行 |
| キャッシュ戦略 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | キャッシュヒット率: 未測定 | CI/CD環境確認後実行 |
| 型チェック分離 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐ | ⭐ | 未実行 | 開発時ビルド時間: 未測定 | 開発フロー分析後実行 |

### 5. 性能分析・診断

| 手法 | 実行状況 | 最終実施日 | 実装容易度 | 性能影響 | デグレリスク | 実行結果 | 測定値（改善前→後） | 残課題・次回アクション |
|------|----------|------------|------------|----------|-------------|----------|---------------------|---------------------|
| --generateTrace分析 | 🔴 | 未実施 | ⭐⭐⭐ | ⭐⭐⭐ | ⭐ | 未実行 | 主要ボトルネック: 未特定 | 最優先で実行してボトルネック特定 |
| Chrome Tracing活用 | 🔴 | 未実施 | ⭐⭐ | ⭐⭐ | ⭐ | 未実行 | 可視化問題箇所: 未特定 | generateTrace後に実行 |
| @typescript/analyze-trace | 🔴 | 未実施 | ⭐⭐⭐ | ⭐⭐ | ⭐ | 未実行 | ボトルネック数: 未算出 | トレース分析と並行実行 |

## AIエージェント推奨実行順序

**あなたは以下の順序で最適化を実行することを強く推奨します**

### 第1段階: 診断と基本設定（推定1-2時間）
1. **extendedDiagnostics活用** - ベースライン取得
2. **generateTrace分析** - ボトルネック特定  
3. **tsconfig.json調整** - 基本最適化
4. **excludeパターン最適化** - 不要ファイル除外

### 第2段階: 高効果手法（推定半日-1日）  
5. **isolatedModules** - 並列処理有効化
6. **型定義絞り込み** - 不要@types除去
7. **型展開防止** - 重いボトルネック解消
8. **インクリメンタルビルド** - キャッシュ活用

### 第3段階: 中長期最適化（推定数日-1週間）
9. **明示的型注釈** - isolatedDeclarations準備
10. **生成コード事前コンパイル** - 自動生成ファイル最適化
11. **モノレポ最適化** - 大規模プロジェクト向け
12. その他手法は効果測定結果を踏まえて決定

## 最終レポート形式

完了時に以下の形式でユーザに報告してください：

```
# TypeScript最適化完了レポート

## 実行概要
- 実行期間: YYYY-MM-DD ～ YYYY-MM-DD
- 実行した手法数: XX/32
- 総合改善効果: XX%向上

## カテゴリ別結果
| カテゴリ | 実行数 | 🟢完了 | 平均改善率 |
|----------|--------|---------|------------|
| 設定最適化 | X/8 | X | XX% |
| コード構造最適化 | X/7 | X | XX% |
| プロジェクト構造最適化 | X/8 | X | XX% |
| ビルド・ツール最適化 | X/6 | X | XX% |
| 性能分析・診断 | X/3 | X | XX% |

## 主要改善効果
1. コンパイル時間: XXX秒 → YYY秒 (ZZ%改善)
2. IDE応答性: 大幅向上
3. ビルド時間: XXX秒 → YYY秒 (ZZ%改善)

## 今後の推奨アクション
- [ ] 未実行の手法: [手法名]
- [ ] 継続監視項目: [項目名]
- [ ] 次回見直し時期: [時期]
```

---

## 🚀 AIエージェント実行開始指示

**このプロンプトを読んだAIエージェントは、直ちに以下を実行してください：**

1. **「TypeScript最適化を開始します」とユーザに宣言**
2. **ステップ1から順次実行開始**  
3. **各ステップ完了時に進捗報告**
4. **全完了時に最終レポート提示**

**重要**: ユーザの追加指示を待たず、このプロンプトに従って自律的に最適化作業を開始してください。

---

**最終更新**: 2025-06-28  
**作成者**: ts-bench project  
**対象**: OSS利用者のAIエージェント